[TOC]



# Mysql笔记

## Mysql行记录怎么存储

以Innodb中的COMPACT 行格式为例

![image-20230406212713960](assets/image-20230406212713960.png)

1. 变长字段长度列表：非必须
2. Null值列表：非必须
3. 记录头信息：含有delete_mark标识是否删除，next_record下一条记录的位置，record_type：表示当前记录的类型，0表示普通记录，1表示B+树非叶子节点记录，2表示最小记录，3表示最大记录
4. row_id：如果我们建表的时候指定了主键或者唯一约束列，那么就没有 row_id 隐藏字段了。如果既没有指定主键，又没有唯一约束，那么 InnoDB 就会为记录添加 row_id 隐藏字段。row_id不是必需的，占用 6 个字节。
5. trx_id：事务id，表示这个数据是由哪个事务生成的。
6. roll_pointer：这条记录上一个版本的指针。

## varchar(n) 中 n 最大取值为多少？

1. MySQL 规定除了 TEXT、BLOBs 这种大对象类型之外，其他所有的列（不包括隐藏列和记录头信息）占用的字节长度加起来不能超过 65535 个字节
2. 65535-2（变长字段所占的字节数）=65533字节，如果是中文，在 UTF-8 字符集下，一个字符最多需要三个字节，varchar(n) 的 n 最大取值就是 65533/3 = 21844
3. MySQL 中磁盘和内存交互的基本单位是页，一个页的大小一般是 `16KB`，也就是 `16384字节`，而一个 varchar(n) 类型的列最多可以存储 `65532字节`，行溢出后，多的数据就会存到另外的「溢出页」中





## 参考

https://xiaolincoding.com/mysql

